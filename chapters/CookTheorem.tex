\begin{theorem}
\labthm{Cook}
Задача о КНФ-выполнимости --- NPC.
\end{theorem}
\begin{proof}
В данном доказательстве мы не можем пользоваться полиномиальной сводимостью к
другим NPC задачам. Только определением класса NP. Задачу КНФ-выполнимость будем
сокращать в этом доказательстве как КНФ-в.

По сути мы должны доказать, что $\forall Z' \in NP$,  $Z' \le_P$ КНФ-в. 

Задачу $Z'$ можно решить за полином на НМТ, для простоты рассуждений возьмём в
качестве полинома --- $n^k$, где n --- длина входа  $|I|$. \marginnote{Понятно,
что если задача решается за время, меньшее, чем $n^k$, то она может быть
решена и за  $n^k$. }

Зададим часть ограничений на нашу НМТ. Пусть она останавливается только в одном
конечном состоянии $q_{final}$

Рассмотрим ту часть работы НМТ, когда она работает как обычная МТ\sidenote{Далее
под работой МТ будет пониматься именно эта часть}, то есть
отгадка уже написана.\sidenote{Угадывающая головка НМТ работает также за
$O(n^k)$}.

Тогда мы за $n^k$ шагов должны дойти до конечного состояния $q_{filal}$,
проверив отгадку.

Представим работу МТ в виде таблицы, в i-й строке которой записано i-е слово
конфигурации этой МТ.
\begin{table}[htpb]
	\centering
	\begin{tabular}{|c|c| c|c|c |c|c|c| c|c|}
\hline №&$-n^k$\ldots& $-m$& \ldots&$-1$&$0$& $1$ &\ldots&$l$&
		\ldots$n^k$\\
		\hline
		      0&$\lambda$\ldots$\lambda$&$u_m$&\ldots&$u_1$&$q_0$&$v_1$&\ldots&$v_l$
			       &$\lambda$\ldots$\lambda$\\\hline
\hline
$n^k$&\ldots&\ldots&\ldots&\ldots&\ldots&\ldots&$q_{final}$&\ldots&\ldots\\\hline
	\end{tabular}
\end{table}

Данная таблица конфигурации будет соответствовать МТ при выполнении 4-х условий
одновременно.
\begin{enumerate}
	\item В каждой ячейке содержится один и только один символ из набора $A
		\cup S \cup \{\lambda\}$
	\item В 0-й строке находятся $-n^k - m$ символов  $\lambda$ после идёт m
		символов отгадки $u_m, \ldots, u_1$, начальное состояние $q_0$,  $l$ символов
		условия $v_1, \ldots, v_l$, а после  $n^k-l$ символов  $\lambda$
	\item В $n^k$-й строке есть ячейка, содержащая $q_{final}$
	\item $k$-я и $(k+1)$-я строки различаются не более чем окошком $2\times
		3$, имеющем вид одной из трёх таблиц, которые соответствуют переходам $qb \to q'cR;$ $qb\to q'cSt;$ $qb\to q'cL $:		

\begin{table}[h!]
\centering
\begin{tabular}{|c|c|c|}
\hline a&q&b\\
\hline a&c&$q'$\\
\hline
\end{tabular}
\end{table}

\begin{table}[h!]
\centering
\begin{tabular}{|c|c|c|}
\hline a&q&b\\
\hline a&$q'$&c\\
\hline
\end{tabular}
\end{table}

\begin{table}[h!]
\centering
\begin{tabular}{|c|c|c|}
\hline a&q&b\\
\hline $q'$&a&c\\
\hline
\end{tabular}
\end{table}

$a, b, c \in A; q, q' \in S$

\end{enumerate}
Если мы сможем перевести эти четыре утверждения в булеву функцию, то значит мы
свели NP-задачу к КНФ-в., потому что эти 4 условия выполняются тогда и только
тогда, когда МТ успешно проверяет отгадку, а значит ответ на задачу I --- да.

Пусть переменная $x_{i,j,\sigma} =$ 1, если в ячейке  $(i,j)$ таблицы
конфигураций содержится символ  $\sigma$ и = 0 во всех остальных случаях.

Первая формула запишется как \[
	\phi_{line} = \bigcap\limits_{-n^k\le i, j\le n^k} \left( \left( \bigcup\limits_{\sigma \in A\cup S \cup
	\{\lambda \} } \left( x_{i,j,\sigma}  \right)  \right) \cap
	\\
	\left(
	\bigcap\limits_{\substack{\sigma\in A\cup S \cup
	\{\lambda \}
	, \\
\xi\in A\cup S \cup\{\lambda \},\\
\sigma \neq \xi
	}} \left( \overline{x_{i,j,\sigma}} \cdot \overline{x_{i,j,\xi}} \right)
\right) \right)
.\] 

Первая часть отвечает за то, чтобы каждая клетка содержала хотя бы один символ
из допустимого множества, вторая часть, чтобы в каждой клетке находилось не
более одного символа из множества допустимых значений.

Второе утверждение может быть записано формулой:
\[
	\phi_{start} = \left( \&_{\substack{-n^k\le j < -m \text{ или} \\ l<j\le n^k}} x_{0,j,\lambda} \right) \& 
	\left( \&_{\substack{-m\le  j < 0 \text{ или}\\ 0<j\le l}}
	\left(\cup_{\sigma \in A} x_{0,j,\sigma}\right) \right) \& 
	\left( x_{0,0,q_0} \right) 
.\] 
Форма записи через или является, возможно, не самое элегантной, зато экономит
время.

Третье утверждение записывается формулой так:
\[
	\phi_{accept} = \cup_{-n^k\le j\le n^k} (x_{n^k, j, q_{final}})
.\] 

По сути эта формула аналогична фрагменту $\phi_1$, мы проверяем, что нашёлся
хотя бы один элемент $q_{final}$ в последней строке. Тот факт, что $q$ в каждой
строке может быть только один, следует из утверждений 1 и 4.

Утверждение 4 обобщённо будет записано так:
 \[
	 \phi_{compute} =  \&_{i\le i\le n^k} (\phi_{i, (i+1)})
.\]

Продолжение следует\ldots
\end{proof}


